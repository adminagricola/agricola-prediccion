<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Predicción Mensual por Variedad</title>

<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;600;700&display=swap" rel="stylesheet">

<style>
body {
    font-family: 'Poppins', sans-serif;
    background-color: #111827;
    color: #f9fafb;
}
.card {
    background: #1f2937;
    border-radius: 1rem;
    padding: 1.5rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}
.selector {
    background-color: #2563eb;
    color: white;
    border: none;
    padding: .7rem 1rem;
    border-radius: .5rem;
}
.selector option {
    background-color: #1e40af;
    color: white;
}
canvas { max-height: 270px; }
</style>
</head>

<body class="min-h-screen py-10 px-6">
<div class="max-w-6xl mx-auto">

<h1 class="text-3xl font-bold text-center mb-10">
    Predicción Mensual por Variedad
</h1>

<div class="card mb-10">
    <h2 class="text-xl font-semibold mb-4 text-blue-400">
        Selecciona una variedad
    </h2>

    <form method="get">
        <select name="variedad" class="selector w-full" onchange="this.form.submit()">
            <option value="">-- Seleccione una variedad --</option>
            {% for v in variedades %}
                <option value="{{ v }}" {% if v == variedad_sel %}selected{% endif %}>
                    {{ v }}
                </option>
            {% endfor %}
        </select>
    </form>
</div>

{% if tabla_semanal %}
{% for variedad, registros in tabla_semanal.items() %}

<div class="card">
<h2 class="text-xl font-semibold mb-6 text-blue-300">{{ variedad }}</h2>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

<div>
<canvas id="graf1"></canvas>
</div>

<div class="overflow-x-auto">
<table class="min-w-full text-sm">
<thead class="border-b border-gray-600">
<tr>
<th class="px-4 py-2">Mes</th>
<th class="px-4 py-2 text-blue-400">HW</th>
<th class="px-4 py-2 text-purple-400">LSTM</th>
</tr>
</thead>
<tbody>
{% for fila in registros %}
<tr class="border-b border-gray-800">
<td class="px-4 py-2">{{ fila.MES }}</td>
<td class="px-4 py-2 text-blue-300">{{ "%.2f"|format(fila.HW) }}</td>
<td class="px-4 py-2 text-purple-300">{{ "%.2f"|format(fila.LSTM) }}</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>

</div>
</div>

{% endfor %}
{% endif %}

</div>

<script>
const datos = {{ tabla_semanal | tojson }};
const registros = Object.values(datos)[0];

new Chart(document.getElementById("graf1"), {
    type: "bar",
    data: {
        labels: registros.map(r => r.MES),
        datasets: [
            {
                label: "HW",
                data: registros.map(r => r.HW)
            },
            {
                label: "LSTM",
                data: registros.map(r => r.LSTM)
            }
        ]
    },
    options: {
        plugins: {
            legend: { labels: { color: "#fff" } }
        },
        scales: {
            x: { ticks: { color: "#ccc" } },
            y: { ticks: { color: "#ccc" } }
        }
    }
});
</script>

</body>
</html>
